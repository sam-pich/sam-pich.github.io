#!/usr/bin/env node

const { writeFileSync, mkdir } = require('fs');
const path = require('path');
const tailwindConfigTs = require('./assets/files/tailwind.config.ts');
const tailwindTsConfig = require('./assets/files/tailwind.tsconfig.json');
const tailwindConfigJs = require('./assets/files/tailwind.config.js');
const postCSSConfig = require('./assets/files/postcss.config.js');
const globalCSS = require('./assets/files/global.css');
const { prompt } = require('inquirer');

(async () => {
  writeFileSync(
    'postcss.config.js',
    'module.exports = ' +
      JSON.stringify(postCSSConfig, null, 2)
  );

  const scriptNames = {
    watchCommand: await prompt([
      {
        type: 'input',
        name: 'watchCommand',
        message:
          'What should the Watch command be called?',
        default: 'tailwind:watch',
      },
    ]).then(({ watchCommand }) => watchCommand),
    buildCommand: await prompt([
      {
        type: 'input',
        name: 'buildCommand',
        message:
          'What should the Build command be called?',
        default: 'tailwind:build',
      },
    ]).then(({ buildCommand }) => buildCommand),
  };

  if (
    await prompt([
      {
        type: 'confirm',
        message: 'Would you like to use typescript?',
        name: 'useTs',
      },
    ])
  ) {
    writeFileSync(
      (
        await prompt([
          {
            type: 'input',
            message:
              'What would you like the tailwind tsconfig file to be called?',
            default: 'tailwind.tsconfig.json',
            name: 'tsconfigName',
          },
        ])
      ).tsconfigName,
      JSON.stringify(tailwindTsConfig, null, 2)
    );

    writeFileSync(
      'tailwind.config.ts',
      `
        import { TailwindConfig } from 'tailwindcss/tailwind-config';

        const config: TailwindConfig = ${JSON.stringify(
          tailwindConfigTs,
          null,
          2
        )}

        module.exports = config
      `
    );

    console.log(`
      Paste the following in the scripts key of your package.json:
        "${scriptNames.watchCommand}": "tsc -w -p tailwind.tsconfig.json;tailwind -m -w -i src/styles/global.css -c tailwind.config.js",
        "${scriptNames.buildCommand}": "tsc -p tailwind.tsconfig.json;tailwind -m -i src/styles/global.css -c tailwind.config.js",
    `);

    console.log(
      'Uncomment everything in the newly created tailwind.config.ts'
    );
  } else {
    writeFileSync(
      'tailwind.config.js',
      `
        const config = ${JSON.stringify(
          tailwindConfigJs,
          null,
          2
        )}

        module.exports = config;
      `
    );

    console.log(`
    Paste the following in the scripts key of your package.json:
      "${scriptNames.watchCommand}": "tailwind -m -w -i src/styles/global.css -c tailwind.config.js",
      "${scriptNames.buildCommand}": "tailwind -m -i src/styles/global.css -c tailwind.config.js",
    `);
  }

  console.log(
    `
      Create src/styles/global.css and paste the following in it:
      @tailwind base;
      @tailwind components;
      @tailwind utilities;
    `
  );

  console.log(`
    Paste the following in your src/pages/_app.{tsx,js}
      import './styles/global.css';
  `);

  console.log(`
    Also run this:
      yarn add tailwindcss postcss autoprefixer;
      yarn add -D @types/tailwindcss;
  `);
})();
